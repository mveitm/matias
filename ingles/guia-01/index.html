<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Unit 5 Quiz - Mat√≠as üöÄ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div id="startScreen">
            <h1>üëã Hi Mat√≠as!</h1>
            <h2>Ready for your English Unit 5 Review? ‚ú®</h2>
            <p>This guide is for you. Just click on the correct answer! Points will be added automatically, and you'll see your grade at the end.</p>
            <button class="start-button" onclick="startQuiz()">Start Quiz üöÄ</button>
        </div>

        <div id="quizScreen" class="hidden">
            <h2 id="sectionTitle"></h2>
            <p class="question-text" id="questionText"></p>
            <div class="options-container" id="optionsContainer">
                </div>
            <p class="feedback" id="feedbackMessage"></p>
            <button id="nextQuestionBtn" class="next-button hidden" onclick="nextQuestion()">Next Question üëâ</button>
        </div>

        <div id="resultsScreen" class="hidden">
            <h1>Congratulations, Mat√≠as! You've completed the Quiz. üéâ</h1>
            <h2>Your Results:</h2>
            <p id="totalPointsDisplay" style="color: #4a148c; font-size: 1.5em;"></p>
            <p id="finalGradeDisplay" style="color: #00796b; font-size: 1.8em; font-weight: bold;"></p>

            <p style="margin-top: 20px;">Keep practicing to improve! üí™</p>
            <button class="restart-button" onclick="restartQuiz()">Try Again üîÑ</button>
            <button class="review-button" onclick="reviewAnswers()">Review Your Answers üîç</button> </div>
    </div>

    <script>
        // Array of objects to store all questions
        const questions = [
            // I. Vocabulary: Connecting People & Digital World (12 Points)
            {
                section: "I. Vocabulary: Connecting People & Digital World üåê",
                question: "A. Choose the word that best completes the sentence. <br> 1. Many people use _______ to share photos and videos with friends. üì∏",
                options: ["a) apps", "b) social media"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "I. Vocabulary: Connecting People & Digital World üåê",
                question: "2. If you want to read information online, you visit a _______. üìñ",
                options: ["a) blog", "b) website"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "I. Vocabulary: Connecting People & Digital World üåê",
                question: "3. I need to _______ these documents to the cloud to access them anywhere. ‚¨ÜÔ∏è",
                options: ["a) download", "b) upload"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "I. Vocabulary: Connecting People & Digital World üåê",
                question: "4. My grandmother prefers to stay _______; she doesn't like using the internet. üìµ",
                options: ["a) offline", "b) online"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "I. Vocabulary: Connecting People & Digital World üåê",
                question: "5. Having a good _______ of contacts can help you find a job. ü§ù",
                options: ["a) community", "b) network"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "I. Vocabulary: Connecting People & Digital World üåê",
                question: "6. You can find many useful _______ for learning languages on your phone. üì±",
                options: ["a) devices", "b) apps"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "I. Vocabulary: Connecting People & Digital World üåê",
                question: "7. He writes a daily _______ about his travels around the world. ‚úàÔ∏è",
                options: ["a) website", "b) blog"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "I. Vocabulary: Connecting People & Digital World üåê",
                question: "8. My new computer has a very fast _______, which helps with games. ‚ö°Ô∏è",
                options: ["a) screen", "b) processor"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "I. Vocabulary: Connecting People & Digital World üåê",
                question: "B. Indicate if the definition is TRUE or FALSE. <br> 9. A **Smartphone** is a type of watch. ‚åöÔ∏è",
                options: ["a) True", "b) False"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "I. Vocabulary: Connecting People & Digital World üåê",
                question: "10. **Wi-Fi** allows you to connect to the internet without cables. üì°",
                options: ["a) True", "b) False"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "I. Vocabulary: Connecting People & Digital World üåê",
                question: "11. **Digital** refers to something that only exists on paper. üìÑ",
                options: ["a) True", "b) False"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "I. Vocabulary: Connecting People & Digital World üåê",
                question: "12. A **Community** is a group of people with similar interests. üèòÔ∏è",
                options: ["a) True", "b) False"],
                correctAnswerIndex: 0,
                points: 1
            },

            // II. Vocabulary: Remember your Manners (12 Points)
            {
                section: "II. Vocabulary: Remember your Manners üòá",
                question: "A. Choose the word that best completes the sentence. <br> 13. It's important to show _______ to your teachers and elders. üôè",
                options: ["a) disrespect", "b) respect"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "II. Vocabulary: Remember your Manners üòá",
                question: "14. Please, don't _______ when I'm speaking. Wait for your turn. ü§ê",
                options: ["a) interrupt", "b) listen"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "II. Vocabulary: Remember your Manners üòá",
                question: "15. Saying \"thank you\" is a sign of good _______. üíñ",
                options: ["a) manners", "b) technology"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "II. Vocabulary: Remember your Manners üòá",
                question: "16. She was very _______ and didn't greet anyone when she entered the room. üò†",
                options: ["a) polite", "b) rude"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "II. Vocabulary: Remember your Manners üòá",
                question: "17. If you make a mistake, you should always _______. üòî",
                options: ["a) apologize", "b) ignore"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "II. Vocabulary: Remember your Manners üòá",
                question: "18. Knowing the proper _______ is important in formal situations. ü§µ‚Äç‚ôÄÔ∏è",
                options: ["a) etiquette", "b) rudeness"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "II. Vocabulary: Remember your Manners üòá",
                question: "19. It's _______ to offer your seat to an older person on the bus. üëç",
                options: ["a) rude", "b) polite"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "II. Vocabulary: Remember your Manners üòá",
                question: "20. He showed great _______ by helping his neighbor with the heavy bags. ü§ó",
                options: ["a) thoughtlessness", "b) consideration"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "II. Vocabulary: Remember your Manners üòá",
                question: "B. Would you consider this action \"good manners\" or \"bad manners\"? <br> 21. Using your phone during family dinner. üìµ",
                options: ["a) Good manners", "b) Bad manners"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "II. Vocabulary: Remember your Manners üòá",
                question: "22. Saying \"please\" when asking for something. üôè",
                options: ["a) Good manners", "b) Bad manners"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "II. Vocabulary: Remember your Manners üòá",
                question: "23. Interrupting someone while they are talking. üó£Ô∏è",
                options: ["a) Good manners", "b) Bad manners"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "II. Vocabulary: Remember your Manners üòá",
                question: "24. Helping someone who drops something. ü§ù",
                options: ["a) Good manners", "b) Bad manners"],
                correctAnswerIndex: 0,
                points: 1
            },

            // III. Grammar: Question Forms (20 Points)
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "A. Is this a \"Subject Question\" (SQ), or \"Object Question\" (OQ)? <br> 25. What did you hear on the news? üì∞",
                options: ["a) SQ", "b) OQ"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "26. Who invented the telephone? üìû",
                options: ["a) SQ", "b) OQ"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "27. Who did you hire for the job? üíº",
                options: ["a) SQ", "b) OQ"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "28. What inspired her to write the book? ‚úçÔ∏è",
                options: ["a) SQ", "b) OQ"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "29. What did you find in the drawer? üìÅ",
                options: ["a) SQ", "b) OQ"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "30. Who took the last cookie? üç™",
                options: ["a) SQ", "b) OQ"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "31. What did you buy at the store? üõçÔ∏è",
                options: ["a) SQ", "b) OQ"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "32. Who painted the Mona Lisa? üñºÔ∏è",
                options: ["a) SQ", "b) OQ"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "33. What caused the power outage? ‚ö°",
                options: ["a) SQ", "b) OQ"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "34. Who did you meet at the party? üéâ",
                options: ["a) SQ", "b) OQ"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "35. What did you eat for lunch? üçΩÔ∏è",
                options: ["a) SQ", "b) OQ"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "36. Who found the lost wallet? üëõ",
                options: ["a) SQ", "b) OQ"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "37. Who did you see at the concert? üé§",
                options: ["a) SQ", "b) OQ"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "38. What disturbed you during the night? ü¶â",
                options: ["a) SQ", "b) OQ"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "B. Choose the correct \"Question Tag\". <br> 39. You like pizza, _______? üçï",
                options: ["a) don't you", "b) do you"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "40. She isn't coming, _______? üö´",
                options: ["a) isn't she", "b) is she"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "41. He can play the guitar, _______? üé∏",
                options: ["a) can he", "b) can't he"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "42. They didn't finish the project, _______? üë∑‚Äç‚ôÄÔ∏è",
                options: ["a) did they", "b) didn't they"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "43. It's a beautiful day, _______? ‚òÄÔ∏è",
                options: ["a) isn't it", "b) is it"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "III. Grammar: Question Forms ‚ùì",
                question: "44. We should go now, _______? ‚è∞",
                options: ["a) shouldn't we", "b) should we"],
                correctAnswerIndex: 0,
                points: 1
            },

            // IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) (20 Points)
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "A. Choose the correct verb form (gerund or infinitive). <br> 45. My brother hates _______ (do) homework. üìö",
                options: ["a) doing", "b) to do"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "46. I decided _______ (learn) a new language. üó£Ô∏è",
                options: ["a) learning", "b) to learn"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "47. Have you finished _______ (clean) your room yet? üßπ",
                options: ["a) cleaning", "b) to clean"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "48. Don't forget _______ (turn off) the lights when you leave. üí°",
                options: ["a) turning off", "b) to turn off"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "49. She suggested _______ (order) some pizza for dinner. üçï",
                options: ["a) ordering", "b) to order"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "50. He agreed _______ (help) me with my math. ‚ûï",
                options: ["a) helping", "b) to help"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "51. I enjoy _______ (spend) time with my family. üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
                options: ["a) spending", "b) to spend"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "52. They stopped _______ (talk) when the movie started. ü§´",
                options: ["a) talking", "b) to talk"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "53. We plan _______ (visit) the museum next week. üèõÔ∏è",
                options: ["a) visiting", "b) to visit"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "54. Would you mind _______ (close) the door, please? üö™",
                options: ["a) closing", "b) to close"],
                correctAnswerIndex: 0,
                points: 1
            },
            // Dialogue B. (10 points total)
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "B. Choose the correct verb form (gerund or infinitive) to complete the dialogue. <br> 55. Anna: Hey Tom, what are you planning (1) _______ (do) this weekend? ü§î",
                options: ["a) doing", "b) to do"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "56. Tom: I'm thinking of (2) _______ (go) hiking. ‚õ∞Ô∏è",
                options: ["a) going", "b) to go"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "57. Tom: I really enjoy (3) _______ (be) in nature. üå≥",
                options: ["a) being", "b) to be"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "58. Anna: That sounds fun! I decided (4) _______ (stay) home. üè°",
                options: ["a) staying", "b) to stay"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "59. Anna: And finish (5) _______ (read) my new book. üìñ",
                options: ["a) reading", "b) to read"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "60. Tom: Oh, remember (6) _______ (send) me that link for the online course. üîó",
                options: ["a) sending", "b) to send"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "61. Tom: I want (7) _______ (check) it out. ‚úÖ",
                options: ["a) checking", "b) to check"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "62. Anna: Sure, I won't forget (8) _______ (send) it. ‚úâÔ∏è",
                options: ["a) sending", "b) to send"],
                correctAnswerIndex: 1,
                points: 1
            },
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "63. Anna: Would you mind (9) _______ (help) me with my computer later? üíª",
                options: ["a) helping", "b) to help"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "IV. Grammar: Verbs followed by -ing and to (Infinitive/Gerund) ‚úÖ",
                question: "64. Anna: It stopped (10) _______ (work) properly. ‚ùå",
                options: ["a) working", "b) to work"],
                correctAnswerIndex: 0,
                points: 1
            },
            
            // V. Grammar: Questions ending with prepositions (16 Points)
            {
                section: "V. Grammar: Questions ending with prepositions üîö",
                question: "A. Rearrange the words to form questions ending with prepositions. <br> 65. With are project this who you working on?",
                options: ["a) Who are you working on this project with?", "b) Who are you working this project on with?"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "V. Grammar: Questions ending with prepositions üîö",
                question: "66. Come meeting up for did you ideas what the with?",
                options: ["a) What ideas did you come up with for the meeting?", "b) What ideas did you come for up the meeting with?"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "V. Grammar: Questions ending with prepositions üîö",
                question: "67. On rely tough during times can who you?",
                options: ["a) Who can you rely on during tough times?", "b) Who can you rely during tough times on?"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "V. Grammar: Questions ending with prepositions üîö",
                question: "68. Apply did what at program school you for?",
                options: ["a) What school program did you apply for?", "b) What did you apply for at school program?"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "V. Grammar: Questions ending with prepositions üîö",
                question: "69. About you who the were to talking plans?",
                options: ["a) Who were you talking to about the plans?", "b) Who were you talking about the plans to?"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "V. Grammar: Questions ending with prepositions üîö",
                question: "70. Looking are to forward you what events?",
                options: ["a) What events are you looking forward to?", "b) What events are you looking to forward?"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "V. Grammar: Questions ending with prepositions üîö",
                question: "71. From information get who did that you?",
                options: ["a) Who did you get that information from?", "b) Who did you get from that information?"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "V. Grammar: Questions ending with prepositions üîö",
                question: "72. Money investment what into did you put your?",
                options: ["a) What did you put your money investment into?", "b) What did you put into your money investment?"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "V. Grammar: Questions ending with prepositions üîö",
                question: "73. Sit event who you at next to did the?",
                options: ["a) Who did you sit next to at the event?", "b) Who did you sit at the event next to?"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "V. Grammar: Questions ending with prepositions üîö",
                question: "74. Worried you what are about risks?",
                options: ["a) What risks are you worried about?", "b) What are you worried about risks?"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "V. Grammar: Questions ending with prepositions üîö",
                question: "B. Write a question for the answers below using the preposition you have. <br> 75. Answer: I'm looking *at the sunset*. üåÖ",
                options: ["a) What are you looking at?", "b) What are you looking?"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "V. Grammar: Questions ending with prepositions üîö",
                question: "76. Answer: She is looking *for Mary*. üïµÔ∏è‚Äç‚ôÄÔ∏è",
                options: ["a) Who is she looking for?", "b) Who is she looking?"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "V. Grammar: Questions ending with prepositions üîö",
                question: "77. Answer: They are talking *to the teacher*. üë©‚Äçüè´",
                options: ["a) Who are they talking to?", "b) Who are they talking?"],
                correctAnswerIndex: 0,
                points: 1
            },
            {
                section: "V. Grammar: Questions ending with prepositions üîö",
                question: "78. Answer: I agree *with his opinion*. üí¨",
                options: ["a) What do you agree with?", "b) What do you agree?"],
                correctAnswerIndex: 0,
                points: 1
            },
        ];

        let currentQuestionIndex = 0;
        let userScore = 0;
        const totalPossiblePoints = 78;
        // Global variable to store user's answers for review
        let userAnswersData = []; 

        // References to HTML elements
        const startScreen = document.getElementById('startScreen');
        const quizScreen = document.getElementById('quizScreen');
        const resultsScreen = document.getElementById('resultsScreen');

        const sectionTitle = document.getElementById('sectionTitle');
        const questionText = document.getElementById('questionText');
        const optionsContainer = document.getElementById('optionsContainer');
        const feedbackMessage = document.getElementById('feedbackMessage');
        const nextQuestionBtn = document.getElementById('nextQuestionBtn');

        const totalPointsDisplay = document.getElementById('totalPointsDisplay');
        const finalGradeDisplay = document.getElementById('finalGradeDisplay');

        // --- Quiz Functions ---

        function startQuiz() {
            sessionStorage.setItem('quizPoints', '0'); // Reset points
            sessionStorage.removeItem('userAnswersData'); // Clear previous review data
            currentQuestionIndex = 0;
            userScore = 0;
            userAnswersData = []; // Reset for new quiz session
            startScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestionIndex < questions.length) {
                const q = questions[currentQuestionIndex];
                sectionTitle.textContent = q.section;
                questionText.innerHTML = q.question; // Use innerHTML for <br>
                optionsContainer.innerHTML = ''; // Clear previous options
                feedbackMessage.textContent = ''; // Clear feedback
                feedbackMessage.className = 'feedback'; // Reset classes
                nextQuestionBtn.classList.add('hidden'); // Hide Next button

                q.options.forEach((optionText, index) => {
                    const button = document.createElement('button');
                    button.textContent = optionText;
                    // Pass the selected option's index to checkAnswer
                    button.onclick = () => checkAnswer(index === q.correctAnswerIndex, index); 
                    optionsContainer.appendChild(button);
                });
            } else {
                showResults();
            }
        }

        // Modified checkAnswer to store the selected option
        function checkAnswer(isCorrect, selectedOptionIndex) {
            const currentQ = questions[currentQuestionIndex];
            const optionsButtons = optionsContainer.querySelectorAll('button');

            // Disable buttons after selection
            optionsButtons.forEach(button => {
                button.disabled = true;
                button.style.cursor = 'not-allowed';
            });

            if (isCorrect) {
                userScore += currentQ.points;
                feedbackMessage.textContent = `Correct! üéâ You earned ${currentQ.points} point${currentQ.points !== 1 ? 's' : ''}.`;
                feedbackMessage.className = 'feedback correct-feedback';
            } else {
                feedbackMessage.textContent = 'Incorrect! üòî Keep practicing.';
                feedbackMessage.className = 'feedback incorrect-feedback';
            }
            
            // Store the answer details for review later
            userAnswersData.push({
                questionIndex: currentQuestionIndex,
                selectedOptionIndex: selectedOptionIndex,
                isCorrect: isCorrect
            });

            // Save both score and answers data to sessionStorage
            sessionStorage.setItem('quizPoints', userScore); 
            sessionStorage.setItem('userAnswersData', JSON.stringify(userAnswersData));

            nextQuestionBtn.classList.remove('hidden'); // Show Next button
        }

        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        function calculateGrade(score) {
            let finalGrade;
            // Minimum grade 2.0 for 0 points.
            // Passing grade 4.0 with 60% requirement (0.60 * 78 = 46.8 points). Rounded to 47 for approval.
            // Maximum grade 7.0 with 78 points.

            const pointsForPass = 47; // 60% of 78 points

            if (score <= pointsForPass) {
                // Range 2.0 to 4.0 (from 0 to 47 points)
                finalGrade = 2.0 + (score / pointsForPass) * 2.0;
            } else {
                // Range 4.0 to 7.0 (from 48 to 78 points)
                finalGrade = 4.0 + ((score - pointsForPass) / (totalPossiblePoints - pointsForPass)) * 3.0;
            }
            
            // Ensure grade is within 1.0 to 7.0 range and round
            finalGrade = Math.min(7.0, Math.max(1.0, finalGrade)).toFixed(1);
            return finalGrade;
        }

        function showResults() {
            quizScreen.classList.add('hidden');
            resultsScreen.classList.remove('hidden');

            // Retrieve final score (in case results page is refreshed)
            // Note: userAnswersData is kept in a global variable for this session,
            // but for robustness, it's also saved/loaded from sessionStorage.
            userScore = parseInt(sessionStorage.getItem('quizPoints') || '0'); 
            totalPointsDisplay.textContent = `Points Obtained: ${userScore} / ${totalPossiblePoints}`;
            
            const grade = calculateGrade(userScore);
            finalGradeDisplay.textContent = `Your Final Grade: ${grade}`;
        }

        // New function to review answers in a new window
        function reviewAnswers() {
            const storedAnswers = JSON.parse(sessionStorage.getItem('userAnswersData')) || [];
            let reviewContent = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Quiz Review - Mat√≠as</title>
                    <style>
                        body { font-family: 'Arial', sans-serif; line-height: 1.6; padding: 20px; background-color: #f4f4f4; color: #333; }
                        h1 { color: #00796b; }
                        .review-question { background-color: #fff; margin-bottom: 20px; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
                        .question-text { font-weight: bold; margin-bottom: 10px; color: #4a148c; }
                        .your-answer, .correct-answer { margin-left: 20px; }
                        .your-answer.correct { color: #2e7d32; font-weight: bold; } /* Green for correct user answer */
                        .your-answer.incorrect { color: #c62828; font-weight: bold; } /* Red for incorrect user answer */
                        .correct-answer-text { color: #00796b; font-weight: bold; } /* Green for correct answer text */
                        .section-divider { border-top: 2px dashed #ccc; margin-top: 30px; padding-top: 20px; }
                    </style>
                </head>
                <body>
                    <h1>Quiz Review for Mat√≠as</h1>
                    <p>Here are your answers and the correct solutions:</p>
            `;

            let lastSection = "";
            storedAnswers.forEach((answerRecord, index) => {
                const q = questions[answerRecord.questionIndex];
                const userAnswerText = q.options[answerRecord.selectedOptionIndex];
                const correctAnswerText = q.options[q.correctAnswerIndex];
                const isCorrectClass = answerRecord.isCorrect ? 'correct' : 'incorrect';
                const resultText = answerRecord.isCorrect ? ' (Correct!)' : ' (Incorrect)';

                if (q.section !== lastSection) {
                    reviewContent += `<h2 class="section-divider">${q.section}</h2>`;
                    lastSection = q.section;
                }

                reviewContent += `
                    <div class="review-question">
                        <p class="question-text">${(answerRecord.questionIndex + 1)}. ${q.question}</p>
                        <p class="your-answer ${isCorrectClass}">Your Answer: ${userAnswerText} ${resultText}</p>
                        ${!answerRecord.isCorrect ? `<p class="correct-answer">Correct Answer: <span class="correct-answer-text">${correctAnswerText}</span></p>` : ''}
                    </div>
                `;
            });

            reviewContent += `</body></html>`;

            const reviewWindow = window.open('', '_blank');
            reviewWindow.document.write(reviewContent);
            reviewWindow.document.close();
        }

        function restartQuiz() {
            sessionStorage.removeItem('quizPoints'); // Clear saved points
            sessionStorage.removeItem('userAnswersData'); // Clear saved review data
            currentQuestionIndex = 0;
            userScore = 0;
            userAnswersData = []; // Reset for new quiz session
            resultsScreen.classList.add('hidden');
            quizScreen.classList.add('hidden'); // Ensure quiz is hidden
            startScreen.classList.remove('hidden');
        }

        // If the page is reloaded, always start from scratch.
        window.onload = () => {
            restartQuiz(); 
        };

        // Initial pre-load to ensure sessionStorage is ready if needed
        if (!sessionStorage.getItem('quizPoints')) {
            sessionStorage.setItem('quizPoints', '0');
        }
    </script>
</body>
</html>
